<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>ASA Sample Document Uploader</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1 {
            color: #2c3e50;
        }

        .section {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-top: 10px;
        }

        select,
        input[type="file"],
        button {
            margin-top: 5px;
            padding: 8px;
        }

        #message {
            margin-top: 15px;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>ASA Sample Document Uploader</h1>

    <!-- Upload Section -->
    <div class="section">
        <h2>Upload a Sample Document</h2>
        <form id="uploadForm" enctype="multipart/form-data">
            <label for="codeSelect">Choose ASA Code:</label>
            <select id="codeSelect" name="code" required>
                <option value="">-- Select a Code --</option>
                <!-- Codes will be filled by JS -->
            </select>

            <label for="fileInput">Select File:</label>
            <input type="file" id="fileInput" name="file" required>

            <br>
            <button type="submit">Upload</button>
        </form>
        <div id="uploadMessage"></div>
    </div>

    <!-- Regenerate Embeddings Section -->
    <div class="section">
        <h2>Regenerate Embeddings</h2>
        <button id="regenerateBtn">Run embedder.py</button>
        <div id="regenMessage"></div>
    </div>

    <script>
        // Full ASA code list
        const codes = [
            "1.1", "1.2", "1.3", "1.4", "1.5", "1.6", "1.7", "1.8.1", "1.8.2", "1.8.3", "1.8.4", "1.8.5", "1.9", "1.11", "1.12", "1.13",
            "1.14.1.1", "1.14.1.2", "1.14.2.1", "1.14.2.2", "2.1.1", "2.1.2", "2.1.3", "2.1.4", "2.1.5.1", "2.1.5.2", "2.1.6", "2.1.7", "2.1.8", "2.1.9", "2.1.10.1", "2.1.10.2",
            "2.2.1", "2.2.2", "2.2.3", "2.2.4", "2.2.5.1", "2.2.5.2", "2.2.5.3", "2.2.5.4", "2.2.6", "2.2.7.1", "2.2.7.2", "2.2.7.3", "2.2.8",
            "2.3.1", "2.3.2.1", "2.3.2.2", "2.3.2.3", "2.3.3.1", "2.3.3.2", "2.3.4.1", "2.3.4.2", "2.3.4.3", "2.3.4.4", "2.3.4.5",
            "2.4.1.1", "2.4.1.2", "2.4.2", "2.4.3.1", "2.4.3.2", "2.4.4.1", "2.4.4.2", "2.4.4.3", "2.4.5", "2.4.6", "2.4.7", "2.4.8", "2.4.9.1", "2.4.9.2", "2.4.9.3",
            "2.5.1", "2.5.2", "2.5.3", "2.6", "2.7", "3.1.1", "3.1.2", "3.2.1", "3.2.2", "3.2.3", "3.3.1", "3.3.2", "3.3.3", "3.4.1", "3.4.2", "3.5", "3.6", "3.7",
            "4.1.1", "4.1.2", "4.1.3", "4.1.4", "4.2.1", "4.2.2", "4.2.3", "4.2.4", "4.3", "4.4.1", "4.4.2", "4.4.3", "4.5.1", "4.5.2", "4.5.3", "4.6.1.1", "4.6.1.2", "4.6.2",
            "4.7.1", "4.7.2", "4.8.1", "4.8.2", "4.9", "4.11.1", "4.11.2", "4.11.3.1", "4.11.3.2", "4.11.4.1", "4.11.4.2", "4.11.5.1", "4.11.5.2", "4.11.6.1", "4.11.6.2",
            "5.1.1", "5.1.2", "5.1.3", "5.1.4", "5.2", "5.3.1", "5.3.2", "5.4.1", "5.4.2", "5.5.1", "5.5.2", "5.6", "5.7.1", "5.7.2", "5.7.3", "5.7.4", "5.7.5",
            "6.1.1", "6.1.2", "6.2.1", "6.2.2", "6.3.1", "6.3.2", "6.4.1", "6.4.2", "6.4.3", "7.1", "7.2", "7.3", "8.1.1", "8.1.2", "9", "10"
        ];

        // Populate dropdown
        const select = document.getElementById("codeSelect");
        codes.forEach(c => {
            const opt = document.createElement("option");
            opt.value = c;
            opt.textContent = c;
            select.appendChild(opt);
        });

        // Handle file upload
        document.getElementById("uploadForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const code = select.value;
            const file = document.getElementById("fileInput").files[0];
            if (!code || !file) return;

            const formData = new FormData();
            formData.append("code", code);
            formData.append("file", file);

            const resp = await fetch("/upload-sample", {
                method: "POST",
                body: formData
            });
            const data = await resp.json();
            document.getElementById("uploadMessage").textContent = data.message || "Upload complete.";
        });

        // Handle regenerate
        document.getElementById("regenerateBtn").addEventListener("click", async () => {
            document.getElementById("regenMessage").textContent = "Running embedder.py...";
            const resp = await fetch("/regenerate", { method: "POST" });
            const data = await resp.json();
            document.getElementById("regenMessage").textContent = data.message || "Done.";
        });
    </script>
</body>

</html>